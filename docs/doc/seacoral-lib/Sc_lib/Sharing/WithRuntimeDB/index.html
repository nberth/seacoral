<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>WithRuntimeDB (seacoral-lib.Sc_lib.Sharing.WithRuntimeDB)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">seacoral-lib</a> &#x00BB; <a href="../../index.html">Sc_lib</a> &#x00BB; <a href="../index.html">Sharing</a> &#x00BB; WithRuntimeDB</nav><header class="odoc-preamble"><h1>Module <code><span>Sharing.WithRuntimeDB</span></code></h1><p>High(er)-level interface built on top of the runtime-database API.</p></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-Log"><a href="#argument-1-Log" class="anchor"></a><code><span><span class="keyword">module</span> </span><span>Log</span><span> : <span class="xref-unresolved">Logs</span>.LOG</span></code></div></div><div class="odoc-spec"><div class="spec parameter anchored" id="argument-2-DB"><a href="#argument-2-DB" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-2-DB/index.html">DB</a></span><span> : <a href="../../Tool/module-type-RuntimeDatabase/index.html">Tool.RuntimeDatabase</a></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><div class="odoc-spec"><div class="spec value anchored" id="val-monitor_inputs_in_dir"><a href="#val-monitor_inputs_in_dir" class="anchor"></a><code><span><span class="keyword">val</span> monitor_inputs_in_dir : 
  <span><span class="optlabel">?filter</span>:<span>(<span><span><span class="type-var">'a</span> <a href="../../../../seacoral-sys/Sc_sys/File/TYPES/index.html#type-file">Sc_sys.File.TYPES.file</a></span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?read_new</span>:<span>(<span><span><span class="type-var">'a</span> <a href="../../../../seacoral-sys/Sc_sys/File/TYPES/index.html#type-file">Sc_sys.File.TYPES.file</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="argument-2-DB/index.html#type-raw_input">DB.raw_input</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">on_new</span>:<span>[&lt; <span>`Func of <span><a href="argument-2-DB/index.html#type-raw_input">DB.raw_input</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span> <span><span>| `ShareAs</span> of string</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="argument-2-DB/index.html#type-runtime_data">DB.runtime_data</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../seacoral-sys/Sc_sys/File/TYPES/index.html#type-dir">Sc_sys.File.TYPES.dir</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>monitor_inputs_in_dir ~filter ~read_new ~on_new rdb dirname</code> creates a thread that monitors file creations in directory <code>dirname</code>: <code>read_new</code> is subsequently called with the name <code>f</code> of any file newly created in <code>dirname</code> (whenever <code>filter f = true</code>, if given) to produce an input <code>v</code>.</p><p>Then, if <code>on_new = `Func f</code> then <code>f</code> is then called with the result <code>v</code>; <code>DB.share_input ~toolname v</code> is called otherwise (<code>on_new = `ShareAs
     toolname</code>).</p><p>By default, <code>read_new</code> is <code>DB.read_input rdb</code>.</p><p>The function promised must be called at most once to terminate the registration of <code>f</code>.</p><p>Please see limitations of <code>Utils.monitor_dir</code> for the case <code>dirname</code> does not exist upon call.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_bidirectional_channel"><a href="#val-with_bidirectional_channel" class="anchor"></a><code><span><span class="keyword">val</span> with_bidirectional_channel : 
  <span><span class="optlabel">?import_suff</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?read_input</span>:<span>(<span><span><span class="type-var">_</span> <a href="../../../../seacoral-sys/Sc_sys/File/TYPES/index.html#type-file">Sc_sys.File.TYPES.file</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="argument-2-DB/index.html#type-raw_input">DB.raw_input</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?write_input</span>:
    <span>[&lt; <span>`Func of <span><span><span class="type-var">_</span> <a href="../../../../seacoral-sys/Sc_sys/File/TYPES/index.html#type-file">Sc_sys.File.TYPES.file</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-2-DB/index.html#type-raw_input">DB.raw_input</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span>
    <span>| `Link</span> Link ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">toolname</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="argument-2-DB/index.html#type-runtime_data">DB.runtime_data</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../seacoral-sys/Sc_sys/File/TYPES/index.html#type-dir">Sc_sys.File.TYPES.dir</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>with_bidirectional_channel ?import_suff ?read_input ?write_input
     ~toolname rdb dirname f</code> calls <code>f</code> after having setup a bi-directional exchange protocol with the runtime database <code>rdb</code>.</p><p>According to this protocol, each file newly created in directory <code>dirname</code> and whose name does not terminate with <code>import_suff</code> (set to <code>&quot;.imported&quot;</code> by default), is read by using <code>read_input</code> (<code>DB.read_input rdb</code> by default), and the resulting input is exported to <code>rdb</code> in the name of <code>toolname</code>.</p><p>Reciprocally, every file shared with <code>rdb</code> during the execution of <code>f</code> and until <code>with_bidirectional_channel</code> terminates is placed into <code>dirname</code> by using <code>write_input</code>: the latter is <code>`Link</code> by default, which means a filesystem link is used; alternatively a user-defined function <code>write</code> may be specified with <code>`Func write</code>. Files imported in this way are not subject to the aforementioned export mechanism.</p><p>Please see limitations of <code>Utils.monitor_dir</code> for the case <code>dirname</code> does not exist upon call; limitations pertaining to the argument <code>write_input</code> also apply.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-import_all_inputs"><a href="#val-import_all_inputs" class="anchor"></a><code><span><span class="keyword">val</span> import_all_inputs : 
  <span><span class="optlabel">?import_suff</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?write_input</span>:
    <span>[&lt; <span>`Func of <span><span><span class="type-var">_</span> <a href="../../../../seacoral-sys/Sc_sys/File/TYPES/index.html#type-file">Sc_sys.File.TYPES.file</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-2-DB/index.html#type-raw_input">DB.raw_input</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span>
    <span>| `Link</span> Link ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="argument-2-DB/index.html#type-runtime_data">DB.runtime_data</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../seacoral-sys/Sc_sys/File/TYPES/index.html#type-dir">Sc_sys.File.TYPES.dir</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../seacoral-basics/Basics/Digests/index.html#type-t">Basics.Digests.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>import_all_inputs ?import_suff ?write_input rdb dirname</code> imports every input previously (given to/shared with) <code>rdb</code> into the directory <code>dirname</code>. Inputs are imported locally using <code>write</code> if <code>write_input = `Func write</code>, or using a file-system link otherwise (i.e, <code>write_input = `Link</code>, the default).</p><p>The directory <code>dirname</code> must exist when this function is called.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-share_input'"><a href="#val-share_input'" class="anchor"></a><code><span><span class="keyword">val</span> share_input' : 
  <span><span class="optlabel">?on_share</span>:<span>(<span><span class="xref-unresolved">Stdlib</span>.Digest.t <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">toolname</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="argument-2-DB/index.html#type-runtime_data">DB.runtime_data</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="argument-2-DB/index.html#type-raw_input">DB.raw_input</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Version of <a href="../../Tool/module-type-RuntimeDatabase/index.html#val-share_input"><code>Tool.RuntimeDatabase.share_input</code></a> that discards the returned digest.</p></div></div></div></body></html>
